# -*-Tcl-*-
#-----------------------------------------------------------------------
# TITLE:
#    ehtml.test
#
# PROJECT:
#    athena-mars
#
# DESCRIPTION:
#    marsutil(n) test suite for ehtml.tcl
#
#-----------------------------------------------------------------------

#-----------------------------------------------------------------------
# Initialize tcltest(n)

if {[lsearch [namespace children] ::tcltest] == -1} {
    package require tcltest 2.2 
    eval ::tcltest::configure $argv
}
 
#-----------------------------------------------------------------------
# Load the package to be tested

package require marsutil

#-----------------------------------------------------------------------
# Test Suite
#
# The tests run in a namespace so as not to interfere with other
# test suites.

namespace eval ::marsutil::test {
    #-------------------------------------------------------------------
    # Set up the test environment

    # Import tcltest(n)
    namespace import ::tcltest::*

    # Import the code to be tested
    namespace import ::marsutil::*

    #-------------------------------------------------------------------
    # Setup

    # setup
    #
    # Set up for tests

    proc setup {} {
        ehtml trans 
        trans manroots {: ./man%s/%n.html}
    }

    # cleanup
    #
    # Cleans up after a test.

    proc cleanup {} {
        trans destroy
    }


    #-------------------------------------------------------------------
    # macros

    test macros-1.1 {hrule} -setup {
        setup
    } -body {
        trans expand {-<<hrule>>-}
    } -cleanup {
        cleanup
    } -result {-<p><hr></p>-}

    test macros-2.1 {lb} -setup {
        setup
    } -body {
        trans expand {-<<lb>>-}
    } -cleanup {
        cleanup
    } -result {-<<-}

    test macros-3.1 {link} -setup {
        setup
    } -body {
        trans expand {-<<link foo.html>>-}
    } -cleanup {
        cleanup
    } -result {-<a href="foo.html">foo.html</a>-}

    test macros-3.2 {link with anchor} -setup {
        setup
    } -body {
        trans expand {-<<link foo.html bar>>-}
    } -cleanup {
        cleanup
    } -result {-<a href="foo.html">bar</a>-}

    test macros-4.1 {nbsp} -setup {
        setup
    } -body {
        trans expand {-<<nbsp "a b c">>-}
    } -cleanup {
        cleanup
    } -result {-a&nbsp;b&nbsp;c-}

    test macros-5.1 {quote} -setup {
        setup
    } -body {
        trans expand {-<<quote "<&>">>-}
    } -cleanup {
        cleanup
    } -result {-&lt;&amp;&gt;-}

    test macros-6.1 {quote} -setup {
        setup
    } -body {
        trans expand {-<<quote "<&>">>-}
    } -cleanup {
        cleanup
    } -result {-&lt;&amp;&gt;-}

    test macros-7.1 {xref} -setup {
        setup
    } -body {
        trans expand {-<<xref foo(n)>>-}
    } -cleanup {
        cleanup
    } -result {-<a href="./mann/foo.html">foo(n)</a>-}

    test macros-7.2 {xref} -setup {
        setup
        trans xrefset foo Foo! ./bar.html
    } -body {
        trans expand {-<<xref foo>>-}
    } -cleanup {
        cleanup
    } -result {-<a href="./bar.html">Foo!</a>-}

    #-------------------------------------------------------------------
    # Cleanup

    cleanupTests
}

namespace delete ::marsutil::test







