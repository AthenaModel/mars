<html>
<head>
<title>mars 3.0.23: gtserver(n) -- Game Truth Server, submodule of marsutil(n)</title>
<style type="text/css" media="screen,print">
/* ehtml(5) Standard CSS */

/*---------------------------------------------------------*/
/* General Use                                             */

a {
    /* No underlines */
    text-decoration: none;
}

/* Special formatting for definition lists, to get proper
 * blank lines after descriptions but not after topics. */
dt {
    margin-bottom: 0;
}

dd { 
    margin-bottom: 1em; 
}

dd > p:first-child { 
    margin-top: 0; 
}


/*---------------------------------------------------------*/
/* Specific Macros                                         */

/* bigmark */
div.bigmark {
    display: inline;
    font-family: Verdana;
    font-size: 100%;
    background: black;
    color: white;
    border: 1px solid black;
    border-radius: 5px;
    padding-left: 2px;
    padding-right: 2px;
}

/* def, defitem, defopt */

dt.def {
    font-weight: bold;
}

dt.defitem {
    font-weight: bold;
    font-family: monospace;
}

dt.defopt {
    font-weight: bold;
    font-family: monospace;
}


/* example/ */
pre.example {
    background:     #FFFDD1 ;
    border:         1px solid blue;
    padding-top:    2px;
    padding-bottom: 2px;
    padding-left:   4px;
}


/* hrule */
hr.hrule {
    margin-top: 1em;
    margin-bottom: 1em;
}

/* iref */
a.iref {
    font-family: monospace;
}

/* itemlist */                
ul.itemlist {
    padding-left: 0;
    list-style-type: none;
}

/* listing/ */
pre.listing {
    background:     #FFFDD1 ;
    border:         1px solid blue;
    padding-top:    4px;
    padding-bottom: 4px;
    padding-left:   4px;
}

span.linenum {
    background:     #E3E08F ;
}

/* mark */
div.mark {
    display:       inline;
    font-family:   Verdana;
    font-size:     75%;
    background:    black;
    color:         white;
    border:        1px solid black;
    border-radius: 5px;
    padding-left:  2px;
    padding-right: 2px;
}

/* procedure */

table.procedure {
    border: 1px solid black;
    border-collapse: collapse;
    width: 100%;
}

table.procedure td {
    border: 1px solid black;
}

td.procedure-index {
    padding-right: 5px;
    text-align: right;
    width: 2em;
}


/* topiclist/ */
.topiclist {
    margin-top:    1em;
    margin-bottom: 1em;
}

tr.topic {
    vertical-align: baseline;
}

tr.topicname {
    min-width: 1.5em;
}

/* tt/ */

.tt {
    font-family: monospace;
}



/* olp/ */

ol.olp > li {
    margin-bottom: 1em;
}

/* ulp/ */

ul.ulp > li {
    margin-bottom: 1em;
}

/*---------------------------------------------------------*/
/* table/ plus macros that use it.    Most formatting is
 * depends on the "table" class.                           */

table {
    margin-top:     1em;
    margin-bottom:  1em;
    vertical-align: baseline;
}

th {
    padding-left: 5px;
    text-align:   left;
}

td {
    padding-left:   5px;
    vertical-align: baseline;
}


/* "table" class: standard table formatting. */
.table {
    border:           1px solid black;
    border-spacing:   0;
    color:            black;
    background-color: white;
}

.table tr:first-child {
    font-weight:      bold;
    color:            white;
    background-color: #000099;    
}

.table tr.tr-odd {
    background-color: #EEEEEE;
}

.table tr.tr-even { }

.table-wide {
    width: 100%;
}

        BODY {
            color: black;
            background: white;
            margin-left: 6%;
            margin-right: 6%;
        }

        H1 {
            margin-left: -5%;
        }
        H2 {
            margin-left: -5%;
        }
        HR {
            margin-left: -5%;
        }

        TABLE {
            text-align:    left;
        }
        
        /* mktree styles */
        ul.mktree  li  { list-style: none; }
        ul.mktree, ul.mktree ul, ul.mktree li { 
            margin-left:10px; padding:0px; }
        ul.mktree li .bullet { padding-left: 10px }
        ul.mktree  li.liOpen   .bullet {cursor : pointer; }
        ul.mktree  li.liClosed .bullet {cursor : pointer; }
        ul.mktree  li.liBullet .bullet {cursor : default; }
        ul.mktree  li.liOpen   ul {display: block; }
        ul.mktree  li.liClosed ul {display: none; }
    
</style>



</head>

<body>
<h1 style="background: red;">
&nbsp;mars 3.0.23: Mars Simulation Support Library
</h1>
    

<h2><a name="name">NAME</a></h2>
    

<p><b>gtserver(n)</b> -- Game Truth Server, submodule of <a href="../mann/marsutil.html">marsutil(n)</a>

</p>

<ul>

    <li><a href="#name">NAME</a></li>
    

    <li><a href="#synopsis">SYNOPSIS</a></li>
    

    <li><a href="#description">DESCRIPTION</a></li>
    

    <li><a href="#protocol">PROTOCOL</a></li>
    

    <li><a href="#commands">COMMANDS</a></li>
    

    <li><a href="#instance_command">INSTANCE COMMAND</a></li>
    

    <li><a href="#example">EXAMPLE</a></li>
    

    <li><a href="#see_also">SEE ALSO</a></li>
    

    <li><a href="#environment">ENVIRONMENT</a></li>
    

    <li><a href="#author">AUTHOR</a></li>
    

    <li><a href="#history">HISTORY</a></li>
    

</ul>
    
    

<h2><a name="synopsis">SYNOPSIS</a></h2>
    

<pre>
package require util 1.0
namespace import ::marsutil::gtserver
</pre>

<ul class="itemlist">
<li><a class="iref" href="#gtserver">gtserver <i>name ?options?</i></a></li>
<li>&nbsp;&nbsp;&nbsp;&nbsp;<a class="iref" href="#gtserver-commserver">-commserver <i>object</i></a></li>
<li>&nbsp;&nbsp;&nbsp;&nbsp;<a class="iref" href="#gtserver-logger">-logger <i>name</i></a></li>
<li>&nbsp;&nbsp;&nbsp;&nbsp;<a class="iref" href="#gtserver-logcomponent">-logcomponent <i>name</i></a></li>
<li>&nbsp;&nbsp;&nbsp;&nbsp;<a class="iref" href="#gtserver-db">-db <i>name</i></a></li>
<li><a class="iref" href="#cget">$gtserver cget <i>option</i></a></li>
<li><a class="iref" href="#configure">$gtserver configure <i>option value...</i></a></li>
<li><a class="iref" href="#set">$gtserver set <i>name value</i> ?<i>name value...</i>?</a></li>
<li><a class="iref" href="#unset">$gtserver unset <i>name</i> ?<i>name</i>...?</a></li>
<li><a class="iref" href="#clear">$gtserver clear</a></li>
<li><a class="iref" href="#refresh">$gtserver refresh ?<i>id</i>?</a></li>
<li><a class="iref" href="#complete">$gtserver complete</a></li>
<li><a class="iref" href="#class">$gtserver class <i>class table idcolumn ?-norefresh?</i></a></li>
<li><a class="iref" href="#update">$gtserver update <i>class id</i> ?<i>dict</i>?</a></li>
<li><a class="iref" href="#delete">$gtserver delete <i>class id</i></a></li>
</ul>


<h2><a name="description">DESCRIPTION</a></h2>
<p>gtserver(n) defines an API for publishing game truth variables to
any number of <a href="../mann/commclient.html">commclient(n)</a> objects via a
<a href="../mann/commserver.html">commserver(n)</a> object.  See the <a href="#example">EXAMPLE</a>, below,
for how to hook up the gtserver(n) to the <a href="../mann/commserver.html">commserver(n)</a>.</p>

<p>Once a gtserver(n) object is created, game truth variables can be
published using the <a class="iref" href="#set">set</a> method, and clients can be refreshed
using the <a class="iref" href="#refresh">refresh</a> method.  Points in time at which the full
set of game truth is guaranteed to be complete and consistent can be
indicated by calling the <a class="iref" href="#complete">complete</a> method.

</p>

<h2><a name="protocol">PROTOCOL</a></h2>
<p>gtserver(n) sends the following messages to clients; note that they
will typically be handled by a <a href="../mann/gtclient.html">gtclient(n)</a> object:

</p>

<dl>
<dt class="def">gt <i>subcommand</i> ?<i>args...</i>?</dt><dd>
All messages sent by gtserver(n) have this form.

</dd>
<dt class="def">gt startrefresh</dt><dd>
The simulation is about to refresh all game truth.

</dd>
<dt class="def">gt endrefresh</dt><dd>
The simulation has finished refreshing all game truth.

</dd>
<dt class="def">gt set <i>name value</i> ?<i>name value...</i>?</dt><dd>
This is a game truth update for one or more game truth
variables..

</dd>
<dt class="def">gt unset ?<i>name...</i>?</dt><dd>
Unsets the named game truth variables.

</dd>
<dt class="def">gt clear</dt><dd>
Unsets all game truth variables.

</dd>
<dt class="def">gt complete</dt><dd>
A game truth update is complete; this indicates that the set
of game truth is now in a consistent state.

</dd>
<dt class="def">gt class</dt><dd>
Declares that a particular class of simulation object will 
be created, updated and deleted during the simulation.

</dd>
<dt class="def">gt create</dt><dd>
Creates a simulation object to be stored in a clients database. 
The object can then be retrieved by interested applications.

</dd>
<dt class="def">gt update</dt><dd>
Updates a simulation object that is stored in a clients database. 
The object can then be retrieved by interested applications.

</dd>
<dt class="def">gt delete</dt><dd>
Deletes a simulation object that is stored in a clients
database.
</dd>
</dl>
<p>Most of the messages are map one-to-one with the gtserver(n) object's
methods; the exception is the <a class="iref" href="#refresh">refresh</a> method, which generates
the following set of messages:

</p>

<pre class="example">
gt startrefresh
gt clear
gt set ...
gt create ...
gt endrefresh
</pre>

<h2><a name="commands">COMMANDS</a></h2>
    

<dl>

<dt class="defitem"><a name="gtserver">gtserver <i>name ?options?</i></a></dt><dd><p>

Creates a new gtserver(n) object called <i>name</i>. The object is
represented as a new Tcl command in the caller's scope;
<a class="iref" href="#gtserver">gtserver</a> returns the fully-qualified form of the
<i>name</i>.</p>

<p>The <a class="iref" href="#gtserver">gtserver</a> may be created with the following options:

</p><dl>

<dt class="defopt"><a name="gtserver-commserver">-commserver <i>object</i></a></dt><dd><p>

The fully-qualified name of the <a href="../mann/commserver.html">commserver(n)</a> object which
the gtserver(n) object will use to send game truth messages to clients.</p>

<p>This option must be set at creation time, and is read-only
thereafter.

</p>
</dd>
<dt class="defopt"><a name="gtserver-logger">-logger <i>name</i></a></dt><dd>

The name of the <a href="../mann/logger.html">logger(n)</a> object to use to log gtserver(n)
activity.

</dd>
<dt class="defopt"><a name="gtserver-logcomponent">-logcomponent <i>name</i></a></dt><dd>

The component name to pass to the <code>-logger</code> object when
logging messages; defaults to "gt".

</dd>
<dt class="defopt"><a name="gtserver-db">-db <i>name</i></a></dt><dd>

The sqlite database that contains simulation objects whose data is sent to
attached clients.

</dd>
</dl>

</dd>
</dl>

<h2><a name="instance_command">INSTANCE COMMAND</a></h2>
<p>Each instance of the <a class="iref" href="#gtserver">gtserver</a> object has the following
subcommands:

</p>

<dl>

<dt class="defitem"><a name="cget">$gtserver cget <i>option</i></a></dt><dd>

Returns the value of the specified <i>option</i>.

</dd>
<dt class="defitem"><a name="configure">$gtserver configure <i>option value...</i></a></dt><dd>

Sets the value of one or more of the object's options.

</dd>
<dt class="defitem"><a name="set">$gtserver set <i>name value</i> ?<i>name value...</i>?</a></dt><dd>

Publishes the named game truth variables with the specified values.
The value will be sent to any current clients, and saved for future
refreshes.

</dd>
<dt class="defitem"><a name="unset">$gtserver unset <i>name</i> ?<i>name</i>...?</a></dt><dd>

Unpublishes the named game truth variables.  The variables are erased from
the gtserver(n)'s memory, and an unset message is sent to all clients.

</dd>
<dt class="defitem"><a name="clear">$gtserver clear</a></dt><dd>

Unpublishes all game truth variables.

</dd>
<dt class="defitem"><a name="refresh">$gtserver refresh ?<i>id</i>?</a></dt><dd>

Sends a game truth refresh to the client with the specified <i>id</i>;
if <i>id</i> is not specified, refreshes all clients.

</dd>
<dt class="defitem"><a name="complete">$gtserver complete</a></dt><dd>

Notifies the clients that the current set of game truth variables is
consistent and complete.  For example, the simulation can call this
method at the end of each timestep to indicate that all published
game truth is consistent with the published simulation time.

</dd>
<dt class="defitem"><a name="class">$gtserver class <i>class table idcolumn ?-norefresh?</i></a></dt><dd>

Defines a class of simulation object that will be created, updated and perhaps 
deleted. Each class has a corresponding <i>table</i> in the runtime database.
This table is the one that has rows created, updated or deleted. The
<i>idcolumn</i> specifies which column in the table is the key column.
If the <i>-norefresh</i> option is used then this class of simulation object is not
refreshed on a refresh request. This is useful for objects that are refreshed
through other means.


</dd>
<dt class="defitem"><a name="update">$gtserver update <i>class id</i> ?<i>dict</i>?</a></dt><dd>

Sends a simulation object with the supplied <i>class</i> to attached clients
with an update message. The object will have the supplied <i>id</i>. 
If a <i>dict</i> is supplied, it is sent to clients, otherwise an attempt is 
made to look up the object with the supplied <i>id</i> in the runtime database
and its dict is sent to clients with an update message. The <i>dict</i> can be
a partial dict.

</dd>
<dt class="defitem"><a name="delete">$gtserver delete <i>class id</i></a></dt><dd>

Sends a delete message to clients with the supplied <i>class</i> and <i>id</i>.


</dd>
</dl>

<h2><a name="example">EXAMPLE</a></h2>
<p>The gtserver(n) is initialized as follows; if the application has a single
gtserver(n), it is conventionally called <code>::gt</code>, as shown.

</p>

<pre class="example">
# FIRST, create the commserver(n) object
commserver ::cs \
   -logger ::log \
   -logcomponent cs \
   -port ...

# NEXT, create the matching gtserver(n) object
gtserver ::gt \
   -logger ::log \
   -logcomponent gt \
   -commserver ::cs \
   -db ::rdb

# NEXT, publish some data!
gt set x 5
gt set y 10

# NEXT, publish a create
gt create foo 99 {bar 1 baz "Fred" id 99}

# NEXT, publish an update
gt update foo 99 {bar 2}

# NEXT, publish a delete
gt delete foo 99

# NEXT, indicate that monitor data is complete:
gt complete
</pre>

<h2><a name="see_also">SEE ALSO</a></h2>
    

<p><a href="../mann/commserver.html">commserver(n)</a>, <a href="../mann/commclient.html">commclient(n)</a>, <a href="../mann/gtclient.html">gtclient(n)</a>.

</p>

<h2><a name="environment">ENVIRONMENT</a></h2>
<p>Requires Tcl 8.5 or later.</p>

<p>To use this package in a Tcl script, the environment variable
<code>TCLLIBPATH</code> must include the parent of the package directory.

</p>

<h2><a name="author">AUTHOR</a></h2>
<p>Will Duquette

</p>

<h2><a name="history">HISTORY</a></h2>
<p>Original package.

</p>

<hr>
<p><i>mars 3.0.23 Man page generated by manpage(n) on 
Fri Nov 20 09:53:52 PST 2015</i>
</p>

</body>
</html>
    







