<html>
<head>
<title>mars 3.0.23: logger(n) -- Application Logger, submodule of marsutil(n)</title>
<style type="text/css" media="screen,print">
/* ehtml(5) Standard CSS */

/*---------------------------------------------------------*/
/* General Use                                             */

a {
    /* No underlines */
    text-decoration: none;
}

/* Special formatting for definition lists, to get proper
 * blank lines after descriptions but not after topics. */
dt {
    margin-bottom: 0;
}

dd { 
    margin-bottom: 1em; 
}

dd > p:first-child { 
    margin-top: 0; 
}


/*---------------------------------------------------------*/
/* Specific Macros                                         */

/* bigmark */
div.bigmark {
    display: inline;
    font-family: Verdana;
    font-size: 100%;
    background: black;
    color: white;
    border: 1px solid black;
    border-radius: 5px;
    padding-left: 2px;
    padding-right: 2px;
}

/* def, defitem, defopt */

dt.def {
    font-weight: bold;
}

dt.defitem {
    font-weight: bold;
    font-family: monospace;
}

dt.defopt {
    font-weight: bold;
    font-family: monospace;
}


/* example/ */
pre.example {
    background:     #FFFDD1 ;
    border:         1px solid blue;
    padding-top:    2px;
    padding-bottom: 2px;
    padding-left:   4px;
}


/* hrule */
hr.hrule {
    margin-top: 1em;
    margin-bottom: 1em;
}

/* iref */
a.iref {
    font-family: monospace;
}

/* itemlist */                
ul.itemlist {
    padding-left: 0;
    list-style-type: none;
}

/* listing/ */
pre.listing {
    background:     #FFFDD1 ;
    border:         1px solid blue;
    padding-top:    4px;
    padding-bottom: 4px;
    padding-left:   4px;
}

span.linenum {
    background:     #E3E08F ;
}

/* mark */
div.mark {
    display:       inline;
    font-family:   Verdana;
    font-size:     75%;
    background:    black;
    color:         white;
    border:        1px solid black;
    border-radius: 5px;
    padding-left:  2px;
    padding-right: 2px;
}

/* procedure */

table.procedure {
    border: 1px solid black;
    border-collapse: collapse;
    width: 100%;
}

table.procedure td {
    border: 1px solid black;
}

td.procedure-index {
    padding-right: 5px;
    text-align: right;
    width: 2em;
}


/* topiclist/ */
.topiclist {
    margin-top:    1em;
    margin-bottom: 1em;
}

tr.topic {
    vertical-align: baseline;
}

tr.topicname {
    min-width: 1.5em;
}

/* tt/ */

.tt {
    font-family: monospace;
}



/* olp/ */

ol.olp > li {
    margin-bottom: 1em;
}

/* ulp/ */

ul.ulp > li {
    margin-bottom: 1em;
}

/*---------------------------------------------------------*/
/* table/ plus macros that use it.    Most formatting is
 * depends on the "table" class.                           */

table {
    margin-top:     1em;
    margin-bottom:  1em;
    vertical-align: baseline;
}

th {
    padding-left: 5px;
    text-align:   left;
}

td {
    padding-left:   5px;
    vertical-align: baseline;
}


/* "table" class: standard table formatting. */
.table {
    border:           1px solid black;
    border-spacing:   0;
    color:            black;
    background-color: white;
}

.table tr:first-child {
    font-weight:      bold;
    color:            white;
    background-color: #000099;    
}

.table tr.tr-odd {
    background-color: #EEEEEE;
}

.table tr.tr-even { }

.table-wide {
    width: 100%;
}

        BODY {
            color: black;
            background: white;
            margin-left: 6%;
            margin-right: 6%;
        }

        H1 {
            margin-left: -5%;
        }
        H2 {
            margin-left: -5%;
        }
        HR {
            margin-left: -5%;
        }

        TABLE {
            text-align:    left;
        }
        
        /* mktree styles */
        ul.mktree  li  { list-style: none; }
        ul.mktree, ul.mktree ul, ul.mktree li { 
            margin-left:10px; padding:0px; }
        ul.mktree li .bullet { padding-left: 10px }
        ul.mktree  li.liOpen   .bullet {cursor : pointer; }
        ul.mktree  li.liClosed .bullet {cursor : pointer; }
        ul.mktree  li.liBullet .bullet {cursor : default; }
        ul.mktree  li.liOpen   ul {display: block; }
        ul.mktree  li.liClosed ul {display: none; }
    
</style>



</head>

<body>
<h1 style="background: red;">
&nbsp;mars 3.0.23: Mars Simulation Support Library
</h1>
    

<h2><a name="name">NAME</a></h2>
    

<p><b>logger(n)</b> -- Application Logger, submodule of <a href="../mann/marsutil.html">marsutil(n)</a>

</p>

<ul>

    <li><a href="#name">NAME</a></li>
    

    <li><a href="#synopsis">SYNOPSIS</a></li>
    

    <li><a href="#description">DESCRIPTION</a></li>
    

    <li><a href="#verbosity">VERBOSITY</a></li>
    <ul>

    <li><a href="#verbosity_levels">Verbosity Levels</a></li>

    <li><a href="#component_verbosity_modes">Component Verbosity Modes</a></li>

</ul>
    

    <li><a href="#entry_format">ENTRY FORMAT</a></li>
    <ul>

    <li><a href="#message_flattening">Message Flattening</a></li>

</ul>
    

    <li><a href="#commands">COMMANDS</a></li>
    

    <li><a href="#instance_command">INSTANCE COMMAND</a></li>
    

    <li><a href="#environment">ENVIRONMENT</a></li>
    

    <li><a href="#author">AUTHOR</a></li>
    

    <li><a href="#history">HISTORY</a></li>
    

</ul>
    
    

<h2><a name="synopsis">SYNOPSIS</a></h2>
    

<pre>
package require marsutil 0.1
namespace import ::marsutil::logger
</pre>

<ul class="itemlist">
<li><a class="iref" href="#logger">logger <i>name ?options?</i></a></li>
<li>&nbsp;&nbsp;&nbsp;&nbsp;<a class="iref" href="#logger-logdir">-logdir <i>name</i></a></li>
<li>&nbsp;&nbsp;&nbsp;&nbsp;<a class="iref" href="#logger-logfile">-logfile <i>name</i></a></li>
<li>&nbsp;&nbsp;&nbsp;&nbsp;<a class="iref" href="#logger-verbosity">-verbosity <i>level</i></a></li>
<li>&nbsp;&nbsp;&nbsp;&nbsp;<a class="iref" href="#logger-maxentries">-maxentries <i>num</i></a></li>
<li>&nbsp;&nbsp;&nbsp;&nbsp;<a class="iref" href="#logger-maxmsglen">-maxmsglen <i>num</i></a></li>
<li>&nbsp;&nbsp;&nbsp;&nbsp;<a class="iref" href="#logger-simclock">-simclock <i>cmd</i></a></li>
<li>&nbsp;&nbsp;&nbsp;&nbsp;<a class="iref" href="#logger-entrycmd">-entrycmd <i>cmd</i></a></li>
<li>&nbsp;&nbsp;&nbsp;&nbsp;<a class="iref" href="#logger-newlogcmd">-newlogcmd <i>cmd</i></a></li>
<li>&nbsp;&nbsp;&nbsp;&nbsp;<a class="iref" href="#logger-overflowcmd">-overflowcmd <i>cmd</i></a></li>
<li><a class="iref" href="#logger_levels">logger levels</a></li>
<li><a class="iref" href="#logger_modes">logger modes</a></li>
<li><a class="iref" href="#logger_unflatten">logger unflatten <i>string</i></a></li>
<li><a class="iref" href="#cget">$logger cget <i>option</i></a></li>
<li><a class="iref" href="#configure">$logger configure <i>option value...</i></a></li>
<li><a class="iref" href="#fatal">$logger fatal <i>component</i> <i>message</i></a></li>
<li><a class="iref" href="#error">$logger error <i>component</i> <i>message</i></a></li>
<li><a class="iref" href="#warning">$logger warning <i>component</i> <i>message</i></a></li>
<li><a class="iref" href="#normal">$logger normal <i>component</i> <i>message</i></a></li>
<li><a class="iref" href="#detail">$logger detail <i>component</i> <i>message</i></a></li>
<li><a class="iref" href="#debug">$logger debug <i>component</i> <i>message</i></a></li>
<li><a class="iref" href="#verbmode">$logger verbmode <i>component</i> ?<i>mode</i>?</a></li>
<li><a class="iref" href="#components">$logger components</a></li>
<li><a class="iref" href="#newlog">$logger newlog ?<i>label</i>?</a></li>
</ul>


<h2><a name="description">DESCRIPTION</a></h2>
<p>logger(n) defines an abstract data type that encapsulates application
logging.  Each instance of logger(n) can manage the program's output
to a succession of log files.  A single application will typically use
just one logger, conventionally called "log".</p>

<p>By default, log entries are written to standard output; log entries
can be written to a file instead, by setting the logger's
<code>-logfile</code> option.</p>

<p>The verbosity of the log (e.g., the quantity and detail of the logged)
can be adjusted at run-time; see <a href="#verbosity">VERBOSITY</a>.</p>

<p>The log entry format is designed for easy parsing and processing;
further, it is extensible.  See <a href="#entry_format">ENTRY FORMAT</a>.</p>

<p>The application can control the log file name explicitly, or it can
specify a log directory and let the logger manage the log file name.

</p>

<h2><a name="verbosity">VERBOSITY</a></h2>
    

<h2><a name="verbosity_levels">Verbosity Levels</a></h2>
<p>The application can tune the verbosity of its logging at run-time by
setting the desired "verbosity level".  Each log entry has a
verbosity level; the entry is logged if and only if its verbosity is
less than or equal to the desired verbosity level.  The verbosity
levels are as follows:

</p>

<table>
<tr>
<th>Level</th>
<th>Used As Desired Verbosity</th>
<th>Used As Entry Verbosity</th>
</tr>

<tr>
<td><b>silent</b></td>
<td>No entries are logged.</td>
<td>N/A</td>
</tr>

<tr>
<td><b>fatal</b></td>
<td>Log <b>fatal</b> entries only.</td>
<td>Entry should say that the application is about to terminate, and
state why.</td>
</tr>

<tr>
<td><b>error</b></td>
<td>Log entries of level <b>error</b> and below.</td>
<td>Entry should record an erroneous but non-fatal condition.</td>
</tr>

<tr>
<td><b>warning</b></td>
<td>Log entries of level <b>warning</b> and below.</td>
<td>Entry should record an anomalous condition.</td>
</tr>

<tr>
<td><b>normal</b></td>
<td>Log entries of level <b>normal</b> and below.</td>
<td>Normal execution logging.</td>
</tr>

<tr>
<td><b>detail</b></td>
<td>Log entries of level <b>detail</b> and below.</td>
<td>Additional debugging trace; low verbosity.</td>
</tr>

<tr>
<td><b>debug</b></td>
<td>Log entries of level <b>debug</b> and below.</td>
<td>Additional debugging trace; high verbosity.  Reserved for
high-volume messages which are enabled only while validating a
particular feature.</td>
</tr>
</table>
<p>The logger's desired verbosity is set using its
<code>-verbosity</code> option; it defaults to <b>normal</b>.</p>

<p>Note that whether an entry is actually logged or not also depends
on the verbosity mode of the component which logs it; see
<a href="#component_verbosity_modes">Component Verbosity Modes</a>.

</p>

<h2><a name="component_verbosity_modes">Component Verbosity Modes</a></h2>
<p>Each log entry includes the name of the particular application or
library component which logged it.  This component name is actually an
arbitrary string; the set of component names used for logging can reflect
the logical architecture rather the physical architecture of the
software.</p>

<p>The primary importance of the component name (other than as an aide to a
person reading the logged entries) is that verbosity can be adjusted
component by component by setting the component's "verbosity mode":

</p>

<table>
<tr>
<th>Mode</th>
<th>Effect On Component's Logging</th>
</tr>

<tr>
<td><b>silent</b></td>
<td>None of the component's entries will be logged.</td>
</tr>

<tr>
<td><b>level</b></td>
<td>The component's entries will be logged in accordance with the
logger's <code>-verbosity</code> setting.</td>
</tr>

<tr>
<td><b>all</b></td>
<td>All of the component's entries will be logged, indepedent of the
logger's <code>-verbosity</code> setting.</td>
</tr>

</table>
<p>A component's verbosity mode defaults to <b>level</b>, and can be
set or retrieved using the logger's <a class="iref" href="#verbmode">verbmode</a> subcommand.

</p>

<h2><a name="entry_format">ENTRY FORMAT</a></h2>
<p>Each log entry is written as a single line of text, formatted as a Tcl
string:

</p>

<pre>&lt;timestamp&gt; &lt;level&gt; &lt;component&gt; &lt;message&gt; ?&lt;simtime&gt;?</pre>

<dl>
<dt class="def"><code>&lt;timestamp&gt;</code></dt><dd>
The wall-clock time when the entry was logged.  The timestamp
has the format "yyyy-mm-ddThh:mm:ss".  TBD: the
timestamp might be extended to subsecond resolution so that log
entries sort unambiguously in time order.

</dd>
<dt class="def"><code>&lt;level&gt;</code></dt><dd>
The verbosity level of the entry.

</dd>
<dt class="def"><code>&lt;component&gt;</code></dt><dd>
The name of the component which logged the entry.

</dd>
<dt class="def"><code>&lt;message&gt;</code></dt><dd>
The message text, flattened to remove newlines.  See
<a href="#message_flattening">Message Flattening</a> for more details.

</dd>
<dt class="def"><code>&lt;simtime&gt;</code></dt><dd>
The simulation time as a human-readable string.  This is
included only if the <code>-simclock</code> option is set.

</dd>
</dl>

<h2><a name="message_flattening">Message Flattening</a></h2>
<p>Each log entry is written as a single line of text for ease of
processing; however, logged message strings might contain newlines.
The logger handles this by "flattening" the message string:

</p>

<ul>
  <li> Any "\" characters in the string are replaced by "\\".
  </li><li> Any newlines in the string are replaced by "\n".
</li></ul>
<p>A log post-processor (e.g., a log browser) can unflatten the message
by reversing the process:

</p>

<ul>
  <li> Replace each "\\" with a "\".
  </li><li> Replace each "\n" with a newline.
</li></ul>
<p>For convenience, the <a class="iref" href="#logger_unflatten">logger unflatten</a> command does this
transformation; otherwise, the following Tcl command will work:

</p>

<pre>string map [list \\\\ \\ \\n \n] $message</pre>

<h2><a name="commands">COMMANDS</a></h2>
    

<dl>

<dt class="defitem"><a name="logger">logger <i>name ?options?</i></a></dt><dd><p>

Creates a new logger object called <i>name</i>. The object is
represented as a new Tcl command in the caller's scope;
<a class="iref" href="#logger">logger</a> returns the fully-qualified form of the
<i>name</i>.</p>

<p>The <a class="iref" href="#logger">logger</a> may be created with the following options:

</p><dl>

<dt class="defopt"><a name="logger-logdir">-logdir <i>name</i></a></dt><dd><p>

Specifies the name of a directory in which the logger can create log
files.  Ideally, the directory should be dedicated to the
application's own log files.</p>

<p>The logger will open new log files at creation time, and when
<a class="iref" href="#newlog">newlog</a> is called.  The log files will have names like this:

</p><pre>&lt;logdir&gt;/log&lt;NNNNN&gt;[_&lt;label&gt;].log</pre>
<p>where <i>logdir</i> is the log directory, <i>NNNNN</i> is a serial
number, and <i>label</i> is a optional label.  When opening a new log
file, the logger will first scan the log directory and pick a
serial number one higher than that of the highest-numbered log file.
The initial log file will have a <i>label</i> of "start"; thereafter,
a label can optionally be supplied to <a class="iref" href="#newlog">newlog</a>.</p>

<p>This option must be set at creation time, and cannot be changed
thereafter.

</p>

</dd>
<dt class="defopt"><a name="logger-logfile">-logfile <i>name</i></a></dt><dd><p>

Specifies the name of a file to which the log entries will be
written.  By default, or if <i>name</i> is the empty string, log
entries will be written to standard output.</p>

<p>If the <code>-logfile</code> is changed to a different file name, the old
file (if any) is closed and the new file is opened.</p>

<p>The log file is closed automatically if the logger is destroyed.</p>

<p>If <code>-logdir</code> is specified, then <code>-logfile</code>
becomes a read-only option: the log file name can be retrieved
but not set.

</p>
</dd>
<dt class="defopt"><a name="logger-verbosity">-verbosity <i>level</i></a></dt><dd><p>

Sets the logger's verbosity level, which defaults to
<b>normal</b>; the allowed values are
<b>silent</b>, 
<b>fatal</b>, 
<b>error</b>, 
<b>warning</b>, 
<b>normal</b>, 
<b>detail</b>, and 
<b>debug</b>.</p>

<p>See <a href="#verbosity">VERBOSITY</a> for more information.

</p>
</dd>
<dt class="defopt"><a name="logger-maxentries">-maxentries <i>num</i></a></dt><dd><p>

Specifies the maximum number of entries allowed in a single
log file.  If the number is exceeded, the logger will automatically
open a new log file.  The default is 5000. Set the option to 0 to
disable this feature.</p>

<p>This option is ignored if <code>-logdir</code> is not set.

</p>
</dd>
<dt class="defopt"><a name="logger-maxmsglen">-maxmsglen <i>num</i></a></dt><dd>

Specifies the maximum number of characters allowed in a log message.
If this number is exceeded the message is truncated and the entry
shown as being too long. The default is 20000.

</dd>
<dt class="defopt"><a name="logger-simclock">-simclock <i>cmd</i></a></dt><dd>

Specifies the name of a <a href="../mani/simclock.html">simclock(i)</a> object.  If set, the
simulation time will be included in every logged message (see
<a href="#entry_format">ENTRY FORMAT</a>.  The option should be set before
any messages are logged (e.g., when the logger(n) object is
created).

</dd>
<dt class="defopt"><a name="logger-entrycmd">-entrycmd <i>cmd</i></a></dt><dd>

Specifies a command to be called whenever an entry is logged.  The
command will be called at global scope with one additional argument,
the entry dictionary.  The command's return value is ignored.

</dd>
<dt class="defopt"><a name="logger-newlogcmd">-newlogcmd <i>cmd</i></a></dt><dd><p>

Specifies a command to be called whenever a new log file is opened,
for whatever reason.  The command will be called
at global scope with one additional argument, the new log file name.
The command's return value is ignored.</p>

<p>Note that the command should not write to the log.

</p>
</dd>
<dt class="defopt"><a name="logger-overflowcmd">-overflowcmd <i>cmd</i></a></dt><dd><p>

<b>Deprecated.</b>  Specifies a command to be called whenever
<code>-maxentries</code> 
is exceeded and a new log file is created.  The command will be called
at global scope with one additional argument, the new log file name.
The command's return value is ignored.</p>

<p>Note that the command should not write to the log.

</p>
</dd>
</dl>

</dd>
<dt class="defitem"><a name="logger_levels">logger levels</a></dt><dd>

Returns a list of the valid verbosity levels, from <b>silent</b> to
<b>debug</b>.

</dd>
<dt class="defitem"><a name="logger_modes">logger modes</a></dt><dd>

Returns a list of the valid component verbosity modes.

</dd>
<dt class="defitem"><a name="logger_unflatten">logger unflatten <i>string</i></a></dt><dd>

Unflattens a log entry's message field, restoring any newline
characters.  See <a href="#message_flattening">Message Flattening</a> for more information.

</dd>
</dl>

<h2><a name="instance_command">INSTANCE COMMAND</a></h2>
<p>Each instance of the <a class="iref" href="#logger">logger</a> object has the following subcommands:

</p>

<dl>

<dt class="defitem"><a name="cget">$logger cget <i>option</i></a></dt><dd>

Returns the value of the specified <i>option</i>.

</dd>
<dt class="defitem"><a name="configure">$logger configure <i>option value...</i></a></dt><dd>

Sets the value of one or more of the object's options.

</dd>
<dt class="defitem"><a name="fatal">$logger fatal <i>component</i> <i>message</i></a></dt>
<dt class="defitem"><a name="error">$logger error <i>component</i> <i>message</i></a></dt>
<dt class="defitem"><a name="warning">$logger warning <i>component</i> <i>message</i></a></dt>
<dt class="defitem"><a name="normal">$logger normal <i>component</i> <i>message</i></a></dt>
<dt class="defitem"><a name="detail">$logger detail <i>component</i> <i>message</i></a></dt>
<dt class="defitem"><a name="debug">$logger debug <i>component</i> <i>message</i></a></dt><dd><p>

Logs an entry with the specified verbosity level, <i>component</i> name,
and <i>message</i>.  Note that
<i>message</i> can be an arbitrary string, though it will usually be a
single line of text with no terminating newline.</p>

<p>See <a href="#verbosity">VERBOSITY</a> and <a href="#entry_format">ENTRY FORMAT</a> for more information.

</p>
</dd>
<dt class="defitem"><a name="verbmode">$logger verbmode <i>component</i> ?<i>mode</i>?</a></dt><dd><p>

If <i>mode</i> is specified, sets the component's verbosity mode to
<b>silent</b>, <b>level</b>, or <b>all</b>.</p>

<p>Returns the component's verbosity mode, which defaults to <b>level</b>.</p>

<p>See <a href="#component_verbosity_modes">Component Verbosity Modes</a> for more information.

</p>
</dd>
<dt class="defitem"><a name="components">$logger components</a></dt><dd>

Returns a list of the names of all components known to the logger
object--that is, all components for which entries have been logged or
for which the component verbosity mode has been set or queried.

</dd>
<dt class="defitem"><a name="newlog">$logger newlog ?<i>label</i>?</a></dt><dd><p>

Opens an automatically named log file in the specified
<code>-logdir</code>; if present, the <i>label</i> will be included in
the new log file's name.  See <code>-logdir</code>, above, for details.</p>

<p>Returns the new file name.

</p>
</dd>
</dl>

<h2><a name="environment">ENVIRONMENT</a></h2>
<p>Requires Tcl 8.5 or later.</p>

<p>To use this package in a Tcl script, the environment variable
<code>TCLLIBPATH</code> must include the parent of the package directory.

</p>

<h2><a name="author">AUTHOR</a></h2>
<p>Will Duquette

</p>

<h2><a name="history">HISTORY</a></h2>
<p>Original package.

</p>

<hr>
<p><i>mars 3.0.23 Man page generated by manpage(n) on 
Fri Nov 20 09:53:52 PST 2015</i>
</p>

</body>
</html>
    







